!function(){"use strict";angular.module("uncertApp.dc",[]).constant("dc",dc),angular.module("uncertApp.d3",[]).constant("d3",d3),angular.module("uncertApp.crossfilter",[]).constant("crossfilter",crossfilter),angular.module("uncertApp.colorbrewer",[]).constant("colorbrewer",colorbrewer),angular.module("uncertApp",["ngAnimate","ngSanitize","ngTouch","ui.bootstrap","uncertApp.fileLoading","uncertApp.breadcrumbs","uncertApp.allactorchart","uncertApp.subwaychart","uncertApp.grouprowchart","uncertApp.lanechart","uncertApp.serieschart","uncertApp.datatable"]).config(["$compileProvider",function(a){a.aHrefSanitizationWhitelist(/^\s*(https?|ftp|mailto|tel|file|blob):/)}]).run(["$timeout","DataService",function(a,b){angular.element(document).ready(function(){a(b.load(),1e3)})}]),angular.module("uncertApp.templates",[]),angular.module("uncertApp.utils",["uncertApp.templates"]),angular.module("uncertApp.ndx",["uncertApp.crossfilter","uncertApp.utils"]),angular.module("uncertApp.allactorchart",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.ndx"]),angular.module("uncertApp.subwaychart",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.ndx"]),angular.module("uncertApp.grouprowchart",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.ndx"]),angular.module("uncertApp.lanechart",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.colorbrewer","uncertApp.ndx"]),angular.module("uncertApp.serieschart",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.ndx"]),angular.module("uncertApp.datatable",["uncertApp.core","uncertApp.utils","uncertApp.d3","uncertApp.dc","uncertApp.ndx"]),angular.module("uncertApp.core",["uncertApp.utils","toastr","uncertApp.ndx"]),angular.module("uncertApp.fileLoading",["uncertApp.core","uncertApp.utils"]),angular.module("uncertApp.breadcrumbs",["uncertApp.core","uncertApp.utils"])}(),function(){"use strict";function a(a){this.publish=function(){return a.$emit.apply(a,arguments)},this.subscribe=function(){return a.$on.apply(a,arguments)}}a.$inject=["$rootScope"],angular.module("uncertApp.utils").service("Messagebus",a)}(),function(){"use strict";angular.module("uncertApp.core").constant("uncertConf",{DATA_JSON_URL:"file:data/contextual.timeline04-02.json"})}(),dc.baseMixin=function(a){function b(){j&&j.attr("width",a.width()).attr("height",a.height())}function c(){return j=a.root().append("svg"),b(),j}function d(b){if(!a[b]||!a[b]())throw new dc.errors.InvalidStateException("Mandatory attribute chart."+b+" is missing on chart[#"+a.anchorName()+"]")}function e(b){if(a.dimension()&&a.dimension().filter){var c=I(a.dimension(),b);c&&(b=c)}return b}a.__dcFlag__=dc.utils.uniqueId();var f,g,h,i,j,k,l,m,n,o=200,p=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().width;return b&&b>o?b:o},q=p,r=200,s=function(a){var b=a&&a.getBoundingClientRect&&a.getBoundingClientRect().height;return b&&b>r?b:r},t=s,u=dc.pluck("key"),v=dc.pluck("value"),w=dc.pluck("key"),x=dc.pluck("key"),y=!1,z=function(b){return a.keyAccessor()(b)+": "+a.valueAccessor()(b)},A=!0,B=!1,C=750,D=dc.printers.filters,E=["dimension","group"],F=dc.constants.DEFAULT_CHART_GROUP,G=d3.dispatch("preRender","postRender","preRedraw","postRedraw","filtered","zoomed","renderlet","pretransition"),H=[],I=function(a,b){return 0===b.length?a.filter(null):1!==b.length||b[0].isFiltered?1===b.length&&"RangedFilter"===b[0].filterType?a.filterRange(b[0]):a.filterFunction(function(a){for(var c=0;c<b.length;c++){var d=b[c];if(d.isFiltered&&d.isFiltered(a))return!0;if(a>=d&&d>=a)return!0}return!1}):a.filterExact(b[0]),b},J=function(a){return a.all()};a.height=function(b){return arguments.length?(t=d3.functor(b||s),a):t(i.node())},a.width=function(b){return arguments.length?(q=d3.functor(b||p),a):q(i.node())},a.minWidth=function(b){return arguments.length?(o=b,a):o},a.minHeight=function(b){return arguments.length?(r=b,a):r},a.dimension=function(b){return arguments.length?(f=b,a.expireCache(),a):f},a.data=function(b){return arguments.length?(J=d3.functor(b),a.expireCache(),a):J.call(a,g)},a.group=function(b,c){return arguments.length?(g=b,a._groupName=c,a.expireCache(),a):g},a.ordering=function(b){return arguments.length?(x=b,l=crossfilter.quicksort.by(x),a.expireCache(),a):x},a._computeOrderedGroups=function(a){var b=a.slice(0);return b.length<=1?b:(l||(l=crossfilter.quicksort.by(x)),l(b,0,b.length))},a.filterAll=function(){return a.filter(null)},a.select=function(a){return i.select(a)},a.selectAll=function(a){return i?i.selectAll(a):null},a.anchor=function(b,c){if(!arguments.length)return h;if(dc.instanceOfChart(b))h=b.anchor(),i=b.root(),k=!0;else{if(!b)throw new dc.errors.BadArgumentException("parent must be defined");h=b.select&&b.classed?b.node():b,i=d3.select(h),i.classed(dc.constants.CHART_CLASS,!0),dc.registerChart(a,c),k=!1}return F=c,a},a.anchorName=function(){var b=a.anchor();return b&&b.id?b.id:b&&b.replace?b.replace("#",""):"dc-chart"+a.chartID()},a.root=function(b){return arguments.length?(i=b,a):i},a.svg=function(b){return arguments.length?(j=b,a):j},a.resetSvg=function(){return a.select("svg").remove(),c()},a.filterPrinter=function(b){return arguments.length?(D=b,a):D},a.controlsUseVisibility=function(b){return arguments.length?(B=b,a):B},a.turnOnControls=function(){if(i){var b=a.controlsUseVisibility()?"visibility":"display";a.selectAll(".reset").style(b,null),a.selectAll(".filter").text(D(a.filters())).style(b,null)}return a},a.turnOffControls=function(){if(i){var b=a.controlsUseVisibility()?"visibility":"display",c=a.controlsUseVisibility()?"hidden":"none";a.selectAll(".reset").style(b,c),a.selectAll(".filter").style(b,c).text(a.filter())}return a},a.transitionDuration=function(b){return arguments.length?(C=b,a):C},a._mandatoryAttributes=function(b){return arguments.length?(E=b,a):E},a.render=function(){G.preRender(a),E&&E.forEach(d);var b=a._doRender();return m&&m.render(),a._activateRenderlets("postRender"),b},a._activateRenderlets=function(b){G.pretransition(a),a.transitionDuration()>0&&j?j.transition().duration(a.transitionDuration()).each("end",function(){G.renderlet(a),b&&G[b](a)}):(G.renderlet(a),b&&G[b](a))},a.redraw=function(){b(),G.preRedraw(a);var c=a._doRedraw();return m&&m.render(),a._activateRenderlets("postRedraw"),c},a.commitHandler=function(b){return arguments.length?(n=b,a):n},a.redrawGroup=function(){return n?n(!1,function(b,c){b?console.log(b):dc.redrawAll(a.chartGroup())}):dc.redrawAll(a.chartGroup()),a},a.renderGroup=function(){return n?n(!1,function(b,c){b?console.log(b):dc.renderAll(a.chartGroup())}):dc.renderAll(a.chartGroup()),a},a._invokeFilteredListener=function(b){void 0!==b&&G.filtered(a,b)},a._invokeZoomedListener=function(){G.zoomed(a)};var K=function(a,b){return null===b||"undefined"==typeof b?a.length>0:a.some(function(a){return a>=b&&b>=a})};a.hasFilterHandler=function(b){return arguments.length?(K=b,a):K},a.hasFilter=function(a){return K(H,a)};var L=function(a,b){for(var c=0;c<a.length;c++)if(a[c]<=b&&a[c]>=b){a.splice(c,1);break}return a};a.removeFilterHandler=function(b){return arguments.length?(L=b,a):L};var M=function(a,b){return a.push(b),a};a.addFilterHandler=function(b){return arguments.length?(M=b,a):M};var N=function(a){return[]};return a.resetFilterHandler=function(b){return arguments.length?(N=b,a):N},a.replaceFilter=function(b){H=[],a.filter(b)},a.filter=function(b){if(!arguments.length)return H.length>0?H[0]:null;var c=H;return b instanceof Array&&b[0]instanceof Array&&!b.isFiltered?b[0].forEach(function(a){c=K(c,a)?L(c,a):M(c,a)}):c=null===b?N(c):K(c,b)?L(c,b):M(c,b),H=e(c),a._invokeFilteredListener(b),null!==i&&a.hasFilter()?a.turnOnControls():a.turnOffControls(),a},a.reverseFilter=function(b){if(!a.hasFilter()){var c=a.data();c.forEach(function(c){b instanceof Array?b.indexOf(c.key)<0&&a.filter(c.key):b!==c.key&&a.filter(c.key)})}return a},a.filters=function(){return H},a.highlightSelected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!0),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.fadeDeselected=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!0)},a.resetHighlight=function(a){d3.select(a).classed(dc.constants.SELECTED_CLASS,!1),d3.select(a).classed(dc.constants.DESELECTED_CLASS,!1)},a.onClick=function(b){var c=a.keyAccessor()(b);dc.events.trigger(function(){1!==d3.event.which||d3.event.shiftKey?1===d3.event.which&&a.reverseFilter(c):a.filter(c,1!==d3.event.which),a.redrawGroup()})},a.filterHandler=function(b){return arguments.length?(I=b,a):I},a._doRender=function(){return a},a._doRedraw=function(){return a},a.legendables=function(){return[]},a.legendHighlight=function(){},a.legendReset=function(){},a.legendToggle=function(){},a.isLegendableHidden=function(){return!1},a.keyAccessor=function(b){return arguments.length?(u=b,a):u},a.valueAccessor=function(b){return arguments.length?(v=b,a):v},a.label=function(b,c){return arguments.length?(w=b,(void 0===c||c)&&(y=!0),a):w},a.renderLabel=function(b){return arguments.length?(y=b,a):y},a.title=function(b){return arguments.length?(z=b,a):z},a.renderTitle=function(b){return arguments.length?(A=b,a):A},a.renderlet=dc.logger.deprecate(function(b){return a.on("renderlet."+dc.utils.uniqueId(),b),a},'chart.renderlet has been deprecated.  Please use chart.on("renderlet.<renderletKey>", renderletFunction)'),a.chartGroup=function(b){return arguments.length?(k||dc.deregisterChart(a,F),F=b,k||dc.registerChart(a,F),a):F},a.expireCache=function(){return a},a.legend=function(b){return arguments.length?(m=b,m.parent(a),a):m},a.chartID=function(){return a.__dcFlag__},a.options=function(b){var c=["anchor","group","xAxisLabel","yAxisLabel","stack","title","point","getColor","overlayGeoJson"];for(var d in b)"function"==typeof a[d]?b[d]instanceof Array&&-1!==c.indexOf(d)?a[d].apply(a,b[d]):a[d].call(a,b[d]):dc.logger.debug("Not a valid option setter name: "+d);return a},a.on=function(b,c){return G.on(b,c),a},a},dc.customCompositeChart=function(a,b){function c(){(void 0===s.rightY()||s.elasticY())&&(void 0===s.rightY()&&s.rightY(d3.scale.linear()),s.rightY().domain([j(),m()]).rangeRound([s.yAxisHeight(),0])),s.rightY().range([s.yAxisHeight(),0]),s.rightYAxis(s.rightYAxis().scale(s.rightY())),s.rightYAxis().orient("right")}function d(){(void 0===s.y()||s.elasticY())&&(void 0===s.y()&&s.y(d3.scale.linear()),s.y().domain([i(),l()]).rangeRound([s.yAxisHeight(),0])),s.y().range([s.yAxisHeight(),0]),s.yAxis(s.yAxis().scale(s.y())),s.yAxis().orient("left")}function e(a,b){a._generateG(s.g()),a.g().attr("class",q+" _"+b)}function f(){return t.filter(function(a){return!a.useRightYAxis()})}function g(){return t.filter(function(a){return a.useRightYAxis()})}function h(a){return a.map(function(a){return a.yAxisMin()})}function i(){return d3.min(h(f()))}function j(){return d3.min(h(g()))}function k(a){return a.map(function(a){return a.yAxisMax()})}function l(){return dc.utils.add(d3.max(k(f())),s.yAxisPadding())}function m(){return dc.utils.add(d3.max(k(g())),s.yAxisPadding())}function n(){return t.map(function(a){return a.xAxisMin()})}function o(){return t.map(function(a){return a.xAxisMax()})}var p,q="sub",r=12,s=dc.coordinateGridMixin({}),t=[],u={},v=!1,w=!0,x=d3.svg.axis(),y=0,z=r,A=!1;return s._mandatoryAttributes([]),s.transitionDuration(500),dc.override(s,"_generateG",function(){for(var a=this.__generateG(),b=0;b<t.length;++b){var c=t[b];e(c,b),c.dimension()||c.dimension(s.dimension()),c.group()||c.group(s.group()),c.chartGroup(s.chartGroup()),c.svg(s.svg()),c.xUnits(s.xUnits()),c.transitionDuration(s.transitionDuration()),c.brushOn(s.brushOn()),c.renderTitle(s.renderTitle()),c.elasticX(s.elasticX())}return a}),s.setHandlePaths=function(){},dc.override(s,"_filter",function(a){return arguments.length?s.__filter(dc.filters.RangedTwoDimensionalFilter(a)):s.__filter()}),s.extendBrush=function(){var a=s.brush().extent();return s.round()&&(a[0]=a[0].map(s.round()),a[1]=a[1].map(s.round()),s.g().select(".brush").call(s.brush().extent(a))),a},s.brushIsEmpty=function(a){return s.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},s._brushing=function(){var a=s.extendBrush();if(s.redrawBrush(s.g()),s.brushIsEmpty(a))dc.events.trigger(function(){s.replaceFilter(null),s.redrawGroup()});else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){s.replaceFilter(b),s.redrawGroup()},dc.constants.EVENT_DELAY)}},s.setBrushY=function(a){a.call(s.brush().y(s.y()))},s._prepareYAxis=function(){0!==f().length&&d(),0!==g().length&&c(),f().length>0&&!A?s._renderHorizontalGridLinesForAxis(s.g(),s.y(),s.yAxis()):g().length>0&&s._renderHorizontalGridLinesForAxis(s.g(),p,x)},s.renderYAxis=function(){0!==f().length&&(s.renderYAxisAt("y",s.yAxis(),s.margins().left),s.renderYAxisLabel("y",s.yAxisLabel(),-90)),0!==g().length&&(s.renderYAxisAt("yr",s.rightYAxis(),s.width()-s.margins().right),s.renderYAxisLabel("yr",s.rightYAxisLabel(),90,s.width()-z))},s.plotData=function(){for(var a=0;a<t.length;++a){var b=t[a];b.g()||e(b,a),v&&b.colors(s.colors()),b.x(s.x()),b.xAxis(s.xAxis()),b.useRightYAxis()?(b.y(s.rightY()),b.yAxis(s.rightYAxis())):(b.y(s.y()),b.yAxis(s.yAxis())),b.plotData(),b._activateRenderlets()}},s.useRightAxisGridLines=function(a){return arguments?(A=a,s):A},s.childOptions=function(a){return arguments.length?(u=a,t.forEach(function(a){a.options(u)}),s):u},s.fadeDeselectedArea=function(){for(var a=0;a<t.length;++a){var b=t[a];b.brush(s.brush()),b.fadeDeselectedArea()}},s.rightYAxisLabel=function(a,b){return arguments.length?(y=a,s.margins().right-=z,z=void 0===b?r:b,s.margins().right+=z,s):y},s.compose=function(a){return t=a,t.forEach(function(a){a.height(s.height()),a.width(s.width()),a.margins(s.margins()),w&&a.title(s.title()),a.options(u)}),s},s.children=function(){return t},s.shareColors=function(a){return arguments.length?(v=a,s):v},s.shareTitle=function(a){return arguments.length?(w=a,s):w},s.rightY=function(a){return arguments.length?(p=a,s.rescale(),s):p},delete s.yAxisMin,delete s.yAxisMax,dc.override(s,"xAxisMin",function(){return dc.utils.subtract(d3.min(n()),s.xAxisPadding())}),dc.override(s,"xAxisMax",function(){return dc.utils.add(d3.max(o()),s.xAxisPadding())}),s.legendables=function(){return t.reduce(function(a,b){return v&&b.colors(s.colors()),a.push.apply(a,b.legendables()),a},[])},s.legendHighlight=function(a){for(var b=0;b<t.length;++b){var c=t[b];c.legendHighlight(a)}},s.legendReset=function(a){for(var b=0;b<t.length;++b){var c=t[b];c.legendReset(a)}},s.legendToggle=function(){console.log("composite should not be getting legendToggle itself")},s.rightYAxis=function(a){return arguments.length?(x=a,s):x},s.anchor(a,b)},dc.customSeriesChart=function(a,b){function c(a,b){return d3.ascending(g.keyAccessor()(a),g.keyAccessor()(b))}function d(a){h[a].g()&&h[a].g().remove(),delete h[a]}function e(){Object.keys(h).map(d),h={}}var f,g=dc.compositeChart(a,b),h={},i=dc.lineChart,j=d3.ascending,k=c;return g._mandatoryAttributes().push("seriesAccessor","chart"),g.shareColors(!0),g._preprocessData=function(){var a,c=[],e=d3.nest().key(f);j&&e.sortKeys(j),k&&e.sortValues(k);var l=e.entries(g.data()),m=l.map(function(d,e){var f=h[d.key]||i.call(g,g,b,d.key,e);return h[d.key]||(a=!0),h[d.key]=f,c.push(d.key),f.dimension(g.dimension()).group({all:d3.functor(d.values)},d.key).keyAccessor(g.keyAccessor()).valueAccessor(g.valueAccessor())});Object.keys(h).filter(function(a){return-1===c.indexOf(a)}).forEach(function(b){d(b),a=!0}),g._compose(m),a&&g.legend()&&g.legend().render()},dc.override(g,"_filter",function(a){return arguments.length?g.__filter(dc.filters.RangedTwoDimensionalFilter(a)):g.__filter()}),g.setHandlePaths=function(){},g.extendBrush=function(){var a=g.brush().extent();return g.round()&&(a[0]=a[0].map(g.round()),a[1]=a[1].map(g.round()),g.g().select(".brush").call(g.brush().extent(a))),a},g.brushIsEmpty=function(a){return g.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},g._brushing=function(){var a=g.extendBrush();if(g.redrawBrush(g.g()),g.brushIsEmpty(a))dc.events.trigger(function(){g.replaceFilter(null),g.redrawGroup()});else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){g.replaceFilter(b),g.redrawGroup()},dc.constants.EVENT_DELAY)}},g.setBrushY=function(a){a.call(g.brush().y(g.y()))},g.chart=function(a){return arguments.length?(i=a,e(),g):i},g.seriesAccessor=function(a){return arguments.length?(f=a,e(),g):f},g.seriesSort=function(a){return arguments.length?(j=a,e(),g):j},g.valueSort=function(a){return arguments.length?(k=a,e(),g):k},g._compose=g.compose,delete g.compose,g},dc.customScatterPlot=function(a,b){function c(a,b){var c=e.selectAll(".chart-body path.symbol").filter(function(){return a(d3.select(this))}),d=f.size();f.size(Math.pow(b,2)),dc.transition(c,e.transitionDuration()).attr("d",f),f.size(d)}function d(a){var b=e.selectAll(".chart-body path.symbol").each(function(b){this.filtered=a&&a.isFiltered(b.key)});dc.transition(b,e.transitionDuration()).attr("d",f)}var e=dc.coordinateGridMixin({}),f=d3.svg.symbol(),g=function(a){return a.value},h=e.keyAccessor();e.keyAccessor(function(a){return h(a)[0]}),e.valueAccessor(function(a){return h(a)[1]}),e.colorAccessor(function(){return e._groupName});var i=function(a){return"translate("+e.x()(e.keyAccessor()(a))+","+e.y()(e.valueAccessor()(a))+")"},j=3,k=5,l=0;return f.size(function(a){return g(a)?this.filtered?Math.pow(k,2):Math.pow(j,2):l}),dc.override(e,"_filter",function(a){return arguments.length?e.__filter(dc.filters.RangedTwoDimensionalFilter(a)):e.__filter()}),e.plotData=function(){var a=e.chartBodyG().selectAll("path.symbol").data(e.data());a.enter().append("path").attr("class","symbol").attr("opacity",0).attr("fill",e.getColor).attr("transform",i),dc.transition(a,e.transitionDuration()).attr("opacity",function(a){return g(a)?1:0}).attr("fill",e.getColor).attr("transform",i).attr("d",f),dc.transition(a.exit(),e.transitionDuration()).attr("opacity",0).remove()},e.existenceAccessor=function(a){return arguments.length?(g=a,this):g},e.symbol=function(a){return arguments.length?(f.type(a),e):f.type()},e.symbolSize=function(a){return arguments.length?(j=a,e):j},e.highlightedSize=function(a){return arguments.length?(k=a,e):k},e.hiddenSize=function(a){return arguments.length?(l=a,e):l},e.legendables=function(){return[{chart:e,name:e._groupName,color:e.getColor()}]},e.legendHighlight=function(a){c(function(b){return b.attr("fill")===a.color},k),e.selectAll(".chart-body path.symbol").filter(function(){return d3.select(this).attr("fill")!==a.color}).classed("fadeout",!0)},e.legendReset=function(a){c(function(b){return b.attr("fill")===a.color},j),e.selectAll(".chart-body path.symbol").filter(function(){return d3.select(this).attr("fill")!==a.color}).classed("fadeout",!1)},e.setHandlePaths=function(){},e.extendBrush=function(){var a=e.brush().extent();return e.round()&&(a[0]=a[0].map(e.round()),a[1]=a[1].map(e.round()),e.g().select(".brush").call(e.brush().extent(a))),a},e.brushIsEmpty=function(a){return e.brush().empty()||!a||a[0][0]>=a[1][0]||a[0][1]>=a[1][1]},e._brushing=function(){var a=e.extendBrush();if(e.redrawBrush(e.g()),e.brushIsEmpty(a))dc.events.trigger(function(){e.filter(null),e.redrawGroup()}),d(!1);else{var b=dc.filters.RangedTwoDimensionalFilter(a);dc.events.trigger(function(){e.filter(null),e.filter(b),e.redrawGroup()},dc.constants.EVENT_DELAY),d(b)}},e.setBrushY=function(a){a.call(e.brush().y(e.y()))},e.anchor(a,b)},dc.customBubbleMixin=function(a){var b=.3,c=10;a.BUBBLE_NODE_CLASS="node",a.BUBBLE_CLASS="bubble",a.MIN_RADIUS=10,a=dc.colorMixin(a),a.renderLabel(!0),a.data(function(a){return a.top(1/0)});var d=d3.scale.linear().domain([0,100]),e=function(a){return a.r};a.r=function(b){return arguments.length?(d=b,a):d},a.radiusValueAccessor=function(b){return arguments.length?(e=b,a):e},a.rMin=function(){var b=d3.min(a.data(),function(b){return a.radiusValueAccessor()(b)});return b},a.rMax=function(){var b=d3.max(a.data(),function(b){return a.radiusValueAccessor()(b)});return b},a.bubbleR=function(b){var c=a.radiusValueAccessor()(b),d=a.r()(c);return(isNaN(d)||0>=c)&&(d=0),d};var f=function(b){return a.label()(b)},g=function(b){return a.bubbleR(b)>c?1:0};a._doRenderLabel=function(b){a.y().range().length,a.effectiveHeight();if(a.renderLabel()){var c=b.select("text");c.empty()&&(c=b.append("text").attr("class","bubble-text").attr("dx",".3em").attr("transform","rotate(-45) translate(5,0) ").attr("text-anchor","left").attr("dy",".3em").on("click",a.onClick)),c.attr("opacity",0).text(f),dc.transition(c,a.transitionDuration()).attr("opacity",g)}},a.doUpdateLabels=function(b){if(a.renderLabel()){var c=b.selectAll("text").text(f);dc.transition(c,a.transitionDuration()).attr("opacity",g)}};var h=function(b){return a.title()(b)};return a._doRenderTitles=function(b){if(a.renderTitle()){var c=b.select("title");c.empty()&&b.append("title").text(h)}},a.doUpdateTitles=function(b){a.renderTitle()&&b.selectAll("title").text(h)},a.minRadius=function(b){return arguments.length?(a.MIN_RADIUS=b,a):a.MIN_RADIUS},a.minRadiusWithLabel=function(b){return arguments.length?(c=b,a):c},a.maxBubbleRelativeSize=function(c){return arguments.length?(b=c,a):b},a.fadeDeselectedArea=function(){a.hasFilter()?a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(b){a.isSelectedNode(b)?a.highlightSelected(this):a.fadeDeselected(this)}):a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(){a.resetHighlight(this)})},a.isSelectedNode=function(b){return a.hasFilter(b.key)},a.onClick=function(b){var c=b.key;dc.events.trigger(function(){a.filter(c),a.redrawGroup()})},a},dc.customBubbleChart=function(a,b){function c(a){var b=i.y().range();a.empty()&&(a=i.chartBodyG().insert("g",":first-child").attr("class","grid-line horizontal").attr("transform","translate("+i.margins().left+","+i.margins().top+")"));var c=a.selectAll("line").data(b),d=c.enter().append("line").attr("x1",-i.margins().left).attr("y1",function(a){return a}).attr("x2",i.xAxisLength()).attr("y2",function(a){return a}).attr("opacity",1);dc.transition(d,i.transitionDuration()).attr("opacity",1),dc.transition(c,i.transitionDuration()).attr("x1",-i.margins().left).attr("y1",function(a){return a}).attr("x2",i.xAxisLength()).attr("y2",function(a){return a}),c.exit().remove()}function d(a){var b=a.enter().append("g");b.attr("class",i.BUBBLE_NODE_CLASS).attr("transform",k).append("circle").attr("class",function(a,b){return i.BUBBLE_CLASS+" _"+b}).on("click",i.onClick).attr("fill",i.getColor).attr("r",0),dc.transition(a,i.transitionDuration()).selectAll("circle."+i.BUBBLE_CLASS).attr("r",function(a){return i.bubbleR(a)}).attr("opacity",function(a){return i.bubbleR(a)>0?1:0}),i._doRenderLabel(b),i._doRenderTitles(b)}function e(a){dc.transition(a,i.transitionDuration()).attr("transform",k).selectAll("circle."+i.BUBBLE_CLASS).attr("fill",i.getColor).attr("r",function(a){return i.bubbleR(a)}).attr("opacity",function(a){return i.bubbleR(a)>0?1:0}),i.doUpdateLabels(a),i.doUpdateTitles(a)}function f(a){a.exit().remove()}function g(a){var b=i.x()(i.keyAccessor()(a));return isNaN(b)&&(b=0),b}function h(a){var b=i.y().range().length,c=i.effectiveHeight(),d=c/b,e=i.y()(i.valueAccessor()(a));return isNaN(e)&&(e=0),dc.utils.safeNumber(e+.5*d)}var i=dc.customBubbleMixin(dc.coordinateGridMixin({})),j=!1;i.transitionDuration(750);var k=function(a){return"translate("+g(a)+","+h(a)+")"};return i.elasticRadius=function(a){return arguments.length?(j=a,i):j},i.plotData=function(){j&&i.r().domain([i.rMin(),i.rMax()]),i.r().range([i.MIN_RADIUS,i.xAxisLength()*i.maxBubbleRelativeSize()]);var a=i.chartBodyG().selectAll("g.horizontal");c(a);var b=i.chartBodyG().selectAll("g."+i.BUBBLE_NODE_CLASS).data(i.data(),function(a){return a.key});d(b),e(b),f(b),i.fadeDeselectedArea()},i.renderBrush=function(){},i.redrawBrush=function(){},i.anchor(a,b)},dc.subwayChart=function(a,b){function c(a,b,c){this.x=a,this.yRaw=b,this.visible=c}function d(a,b){this.lineID=a,this.stations=b,this.segments=[]}function e(a,b){return void 0===b[a.x]?b[a.x]=[a]:b[a.x].push(a),b}function f(a){var b=Object.keys(a);b.sort(function(a,b){return new Date(a)-new Date(b)});var c=[];return b.forEach(function(b){a[b].forEach(function(a){a.yRaw.forEach(function(a){c.indexOf(a)<0&&c.push(a)})})}),c}function g(a){return!a||a.indexOf("NaN")>=0||a.indexOf("Infinity")>=0?"M0,0":a}function h(a){a.enter().insert("g",":first-child").attr("stroke",function(a){return v(a.lineID)}).attr("class",function(a,b){return"subway-line _"+b});var b=a.selectAll("path.diagonal").data(function(a){return a.segments});b.enter().insert("path").attr("class","diagonal").attr("d",function(a){var b,c,d={x:E(a.source.x),y:F(a.source.yRaw)};if(a.source.visible&&a.target.visible)return d={x:E(a.source.x),y:F(a.source.yRaw)},b={x:E(a.target.x),y:F(a.target.yRaw)},g(D({source:d,target:b}));if(a.source.visible&&!a.target.visible)for(d={x:E(a.source.x),y:F(a.source.yRaw)},c=a.nextSegment;void 0!==c;){if(c.target.visible)return b={x:E(c.target.x),y:F(c.target.yRaw)},g(D({source:d,target:b}));c=c.nextSegment}}).attr("stroke-opacity",function(a){return 1}),b.exit().remove(),a.exit().remove()}function i(a){var b=a.selectAll("path.diagonal").data(function(a){return a.segments});dc.transition(b,r.transitionDuration()).attr("d",function(a){var b,c={x:E(a.source.x),y:F(a.source.yRaw)};if(a.source.visible&&a.target.visible)return b={x:E(a.target.x),y:F(a.target.yRaw)},g(D({source:c,target:b}));if(a.source.visible&&!a.target.visible)for(var d=a.nextSegment;void 0!==d;){if(d.target.visible)return b={x:E(d.target.x),y:F(d.target.yRaw)},g(D({source:c,target:b}));d=d.nextSegment}else!a.source.visible&&a.target.visible&&console.log("update source not visible: "+a.source)}).attr("stroke-opacity",function(a){return 1}),b.exit().remove(),a.exit().remove()}function j(a){var b=a.selectAll("path.diagonal").data(function(a){return a.segments});b.exit().remove(),a.exit().remove()}function k(a){var b=a.enter().append("g");b.attr("class",r.BUBBLE_NODE_CLASS).attr("transform",w).append("ellipse").attr("class",function(a,b){return r.BUBBLE_CLASS+" _"+b}).on("click",r.onClick).attr("fill",r.getColor).attr("width",0).attr("height",0),dc.transition(a,r.transitionDuration()).selectAll("ellipse."+r.BUBBLE_CLASS).attr("ry",function(a){return r.bubbleR(a)}).attr("rx",function(a){return r.minRadius()}).attr("opacity",function(a){return r.bubbleR(a)>0?1:0}),r._doRenderLabel(b),r._doRenderTitles(b)}function l(a){dc.transition(a,r.transitionDuration()).attr("transform",w).selectAll("ellipse."+r.BUBBLE_CLASS).attr("fill",r.getColor).attr("ry",function(a){return r.bubbleR(a)}).attr("rx",function(a){return r.minRadius()}).attr("opacity",function(a){return r.bubbleR(a)>0?1:0}),r.doUpdateLabels(a),r.doUpdateTitles(a)}function m(a){a.exit().remove()}function n(a){var b=r.x()(r.keyAccessor()(a));return isNaN(b)&&(b=0),b}function o(a){var b=y(r.keyAccessor()(a),{yRaw:r.valueAccessor()(a)});return b}var p,q,r=dc.customBubbleMixin(dc.stackMixin(dc.coordinateGridMixin({}))),s=!1,t="monotone",u=.1;r.BUBBLE_CLASS="subwayBubble";var v;r.transitionDuration(750);var w=function(a){return"translate("+n(a)+","+o(a)+")"};r.elasticRadius=function(a){return arguments.length?(s=a,r):s};var x,y=function(a,b){for(var c=r.y().range().length,d=r.effectiveHeight(),e=d/c,f=0,g=r.y().domain(),h=0;h<g.length;h++)b.yRaw.indexOf(g[h])>=0&&(f=r.y()(g[h]));var i=f;isNaN(i)&&(i=0);var j=dc.utils.safeNumber(i+.5*e);return j},z=function(a){var b={};return a.forEach(function(a){if(a.value.count>0){var d=a.key[0],f=r.valueAccessor()(a);e(new c(new Date(d),f,!0),b)}}),b},A=function(a,b){var f={};a.forEach(function(a){void 0===f[a]&&(f[a]=new d(a,{})),e(new c(new Date(-864e13),[a],!0),f[a].stations),e(new c(new Date(864e13),[a],!0),f[a].stations)}),Object.keys(b).forEach(function(a){Object.keys(b[a]).forEach(function(c){var d=b[a][c],g=d.yRaw;g.forEach(function(a){e(d,f[a].stations)})})});var g=Object.keys(f).map(function(a){return f[a]});return g},B=function(a,b,c){return this.visibleTimeStrings=Object.keys(c),this.visibleTimeStrings.push(new Date(864e13).toString()),this.visibleTimeStrings.push(new Date(-864e13).toString()),this.visibleDomain=b,a.forEach(function(a){var b=a.stations,c=Object.keys(b);c.forEach(function(a){var c=b[a];Object.keys(c).forEach(function(b){var d=c[b],e=!1;d.yRaw.forEach(function(a){this.visibleDomain.indexOf(a)>=0&&(e=!0)}.bind(this)),e&&this.visibleTimeStrings.indexOf(a)>=0?d.visible=!0:d.visible=!1}.bind(this))}.bind(this))}.bind(this)),a},C=function(a,b){var c=function(a,c){return b.indexOf(a.yRaw[0])-b.indexOf(c.yRaw[0])};return a.forEach(function(a){var b=Object.keys(a.stations);b.sort(function(a,b){return new Date(a)-new Date(b)});for(var d=b.length,e=a.stations[b[0]][0],f=null,g=1;d>g;g++){var h=b[g],i=a.stations[h];i.sort(c);for(var j=i.length,k=0;j>k;k++){var l={source:e,target:i[k]};a.segments.push(l),e=i[k],null!==f&&(f.nextSegment=l,l.lastSegment=f),f=l}}}),a},D=d3.svg.diagonal().source(function(a){return{x:a.source.y,y:a.source.x}}).target(function(a){return{x:a.target.y,y:a.target.x}}).projection(function(a){return[a.y,a.x]}),E=function(a){var b=r.x()(a);return 0>b?b=0:b>r.x().range()[1]&&(b=r.x().range()[1]),b},F=function(a){var b=y(null,{yRaw:a}),c=r.y().range();return c.sort(function(a,b){return b-a}),0>b?b=0:b>c[c.length]&&(b=c[c.length]),b},G=!1;return r.plotData=function(){var a=z(r.data()),b=f(a);r.y().domain(b),G?B(x,b,a):(v=d3.scale.category20b().domain(b),x=A(b,a),x=B(x,b,a),x=C(x,b),G=!0);var c=r.chartBodyG().selectAll("g.subway-line").data(x);h(c),i(c),j(c),s&&r.r().domain([r.rMin(),r.rMax()]),r.r().range([r.MIN_RADIUS,r.xAxisLength()*r.maxBubbleRelativeSize()]);var d=r.chartBodyG().selectAll("g."+r.BUBBLE_NODE_CLASS).data(r.data(),function(a){return a.key});k(d),l(d),m(d),r.rescale(),r.fadeDeselectedArea()},r.interpolate=function(a){return arguments.length?(t=a,r):t},r.tension=function(a){return arguments.length?(u=a,r):u},r.defined=function(a){return arguments.length?(p=a,r):p},r.dashStyle=function(a){return arguments.length?(q=a,r):q},r.renderBrush=function(){},r.redrawBrush=function(){},r.anchor(a,b)},dc.laneChart=function(a,b){function c(){if(!t||u){var a=d3.extent(v,G.cappedValueAccessor);a[0]>0&&(a[0]=0),t=d3.scale.linear().domain(a).range([0,G.effectiveWidth()])}H.scale(t)}function d(){var a=s.select("g.axis");c(),a.empty()&&(a=s.append("g").attr("class","axis")),a.attr("transform","translate(0, "+G.effectiveHeight()+")"),dc.transition(a,G.transitionDuration()).call(H)}function e(){s.selectAll("g.tick").select("line.grid-line").remove(),s.selectAll("g.tick").append("line").attr("class","grid-line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",function(){return-G.effectiveHeight()})}function f(){v=G.data(),d(),e();var a=s.selectAll("g."+D).data(v);g(a),h(a),j(a)}function g(a){var b=a.enter().append("g").attr("class",function(a,b){return D+" _"+b});b.append("rect").attr("width",0),l(b),m(a)}function h(a){a.exit().remove()}function i(){var a=t(0);return a===-(1/0)||a!==a?t(1):a}function j(a){var b,c=v.length;b=C?C:(G.effectiveHeight()-(c+1)*B)/c,y||(x=b/2);var d=a.attr("transform",function(a,c){return"translate(0,"+((c+1)*B+c*b)+")"}).select("rect").attr("height",b).attr("fill",G.getColor).on("click",n).classed("deselected",function(a){return G.hasFilter()?!p(a):!1}).classed("selected",function(a){return G.hasFilter()?p(a):!1});dc.transition(d,G.transitionDuration()).attr("width",function(a){return Math.abs(i()-t(G.valueAccessor()(a)))}).attr("transform",o),k(a),m(a)}function k(a){G.renderTitle()&&(a.selectAll("title").remove(),a.append("title").text(G.title()))}function l(a){G.renderLabel()&&a.append("text").on("click",n),G.renderTitleLabel()&&a.append("text").attr("class",E).on("click",n)}function m(a){if(G.renderLabel()){var b=a.select("text").attr("x",w).attr("y",x).attr("dy",z).on("click",n).attr("class",function(a,b){
return D+" _"+b}).text(function(a){return G.label()(a)});dc.transition(b,G.transitionDuration()).attr("transform",o)}if(G.renderTitleLabel()){var c=a.select("."+E).attr("x",G.effectiveWidth()-A).attr("y",x).attr("text-anchor","end").on("click",n).attr("class",function(a,b){return E+" _"+b}).text(function(a){return G.title()(a)});dc.transition(c,G.transitionDuration()).attr("transform",o)}}function n(a){G.onClick(a)}function o(a){var b=t(G.cappedValueAccessor(a)),c=i(),d=b>c?c:b;return"translate("+d+",0)"}function p(a){return G.hasFilter(G.cappedKeyAccessor(a))}function q(a){J[a].g()&&J[a].g().remove(),delete J[a]}function r(){Object.keys(J).map(q),J={}}var s,t,u,v,w=10,x=15,y=!1,z="0.35em",A=2,B=5,C=!1,D="row",E="titlerow",F=!1,G=dc.capMixin(dc.marginMixin(dc.colorMixin(dc.baseMixin({})))),H=d3.svg.axis().orient("bottom");G.rowsCap=G.cap,G._doRender=function(){return G.resetSvg(),s=G.svg().append("g").attr("transform","translate("+G.margins().left+","+G.margins().top+")"),f(),G},G.title(function(a){return G.cappedKeyAccessor(a)+": "+G.cappedValueAccessor(a)}),G.label(G.cappedKeyAccessor),G.x=function(a){return arguments.length?(t=a,G):t},G.renderTitleLabel=function(a){return arguments.length?(F=a,G):F},G._doRedraw=function(){return f(),G},G.xAxis=function(){return H},G.fixedBarHeight=function(a){return arguments.length?(C=a,G):C},G.gap=function(a){return arguments.length?(B=a,G):B},G.elasticX=function(a){return arguments.length?(u=a,G):u},G.labelOffsetX=function(a){return arguments.length?(w=a,G):w},G.labelOffsetY=function(a){return arguments.length?(x=a,y=!0,G):x},G.titleLabelOffsetX=function(a){return arguments.length?(A=a,G):A};var I,J={};dc.lineChart,d3.ascending;return G.seriesAccessor=function(a){return arguments.length?(I=a,r(),G):I},G.anchor(a,b)},function(){"use strict";function a(a,b,c){var d=this;this.query=b.DATA_JSON_URL,this.clear=function(){d.query=b.DATA_JSON_URL,d.open()},this.open=function(){a.ready.then(function(){c.publish("data request",d.query)})},this.search=function(){d.open()},this.onQueryKeyPress=function(a){var b=13;a.keyCode===b&&d.open()}}a.$inject=["DataService","uncertConf","Messagebus"],angular.module("uncertApp.fileLoading").controller("FileController",a)}(),function(){"use strict";function a(){return{restrict:"EA",templateUrl:"scripts/fileloading/fileLoading.directive.html",controller:"FileController",controllerAs:"fc"}}angular.module("uncertApp.fileLoading").directive("fileLoadingDirective",a)}(),function(){"use strict";function a(a,b){var c=this;c.charts={},c.filters=[],this.click=function(a){var d="";c.filters.forEach(function(b){b.filterString===a.filterString&&(d=b)}),b.publish("filterThis",{chart:c.charts[a.chartID],filters:d.filter})},b.subscribe("clearFilters",function(){c.charts={},c.filters=[]}),b.subscribe("newFilterEvent",function(b,d){var e=d[0].chartID(),f=d[0],g=d[2];c.charts[e]=f,a.$evalAsync(function(){c.filters=[];var a=Object.keys(c.charts);a.forEach(function(a){c.charts[a].filters().forEach(function(b){c.filters.push({chartID:a,filter:b,filterString:b.toString(),dimension:g})})})})})}a.$inject=["$scope","Messagebus"],angular.module("uncertApp.breadcrumbs").controller("BreadcrumbsController",a)}(),function(){"use strict";function a(){return{restrict:"EA",templateUrl:"scripts/breadcrumbs/breadcrumbs.directive.html",controller:"BreadcrumbsController",controllerAs:"bc"}}angular.module("uncertApp.breadcrumbs").directive("breadcrumbsDirective",a)}(),function(){"use strict";function a(a,b){var c=function(a){return a.reduce(function(a,b){return a.indexOf(b)<0&&a.push(b),a},[])};this.determineUniqueActors=function(a){var b=[],d=Object.keys(a.actors);0===d.length?b.push("none"):d.forEach(function(c){var d=a.actors[c];d.forEach(function(a){var c=a.split(":");if(c.length>1){var d=c[0],e=c[1];"nwr-non-entities"===d||"ne"===d||b.push(d+":"+e)}else b.push(c[0])})});var e=c(b);return e};var d=function(a,b){return a.filter(null),0===b.length?a.filter(null):a.filterFunction(function(a){for(var c=0;c<b.length;c++){var d=b[c];if(d.isFiltered&&d.isFiltered(a))return!0;if(a>=d&&d>=a)return!0}return!1}),b};this.customDefaultFilterHandler=function(a,c){return b.publish("newFilterEvent",[this,c,a]),d(a,c)},this.symbolScale=a.scale.ordinal().range(a.svg.symbolTypes),this.setGroupColors=function(a){this.groupColors=a},this.getGroupColors=function(){return this.groupColors}}a.$inject=["d3","Messagebus"],angular.module("uncertApp.utils").service("HelperFunctions",a)}(),function(){"use strict";function a(a,b){this.data={},this.dimensions=[],this.getData=function(){return this.data},this.getSize=function(){return this.ndx.size()},this.readData=function(c){this.data=c,this.ndx=a(c.timeline.events),b.publish("crossfilter ready",this.getData)},this.buildDimension=function(a){var b=this.ndx.dimension(a);return this.dimensions.push(b),b},this.resetData=function(){this.dimensions.forEach(function(a){a.filter(null),a.dispose()}),this.ndx.remove(),b.publish("clearFilters")},b.subscribe("data loaded",function(a,b){var c=b();this.ndx&&this.data&&c&&this.data!==c?(this.resetData(),this.readData(c)):this.readData(c)}.bind(this))}a.$inject=["crossfilter","Messagebus"],angular.module("uncertApp.ndx").service("NdxService",a)}(),function(){"use strict";function a(a,b,c,d,e,f){this.initializeChart=function(){function g(a,b){var c=Object.keys(b.actors);return 0===c.length?a.none=(a.none||0)+1:c.forEach(function(c){var d=b.actors[c];d.forEach(function(b){var c=b.split(":"),d=c[0];"nwr-non-entities"===d||"ne"===d||(a[b]=(a[b]||0)+1)})}),a}function h(a,b){var c=Object.keys(b.actors);return 0===c.length?a.none=(a.none||0)-1:c.forEach(function(c){var d=b.actors[c];d.forEach(function(b){var c=b.split(":"),d=c[0];"nwr-non-entities"===d||"ne"===d||(a[b]=(a[b]||0)-1)})}),a}function i(){return{}}var j=c.rowChart("#"+a[0].children[0].attributes.id.value),k=d.buildDimension(function(a){return e.determineUniqueActors(a)}),l=k.groupAll().reduce(g,h,i).value();l.all=function(){var a=[];for(var b in this)this.hasOwnProperty(b)&&"all"!==b&&"top"!==b&&"order"!==b&&a.push({key:b,value:this[b]});return a},l.top=function(a){var b=this.all().sort(function(a,b){return b.value-a.value}).slice(0,a);return b},j.width(parseInt(a[0].getClientRects()[1].width,10)).height(400).margins({top:10,right:0,bottom:20,left:0}).dimension(k).keyAccessor(function(a){return a.key}).group(l).valueAccessor(function(a){return a.value}).x(b.scale.linear()).elasticX(!0).filterHandler(function(a,b){return f.publish("newFilterEvent",[this,b,a]),a.filter(null),0===b.length?a.filter(null):a.filter(function(a){var b=!0;if(null!==j.filters()){var c=j.filters();c.forEach(function(c){a.indexOf(c)<0&&(b=!1)})}return b}),b}.bind(j)).xAxis().tickValues([]),j.render()},f.subscribe("crossfilter ready",function(){this.initializeChart()}.bind(this))}a.$inject=["$element","d3","dc","NdxService","HelperFunctions","Messagebus"],angular.module("uncertApp.allactorchart").controller("AllActorChartController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/allactorchart/allActorChart.directive.html",controller:"AllActorChartController",controllerAs:"aacCtrl"}}angular.module("uncertApp.allactorchart").directive("allActorChartDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g,h){this.sources={};var i=function(a,b){var c;return a.forEach(function(a){0===a.uri.localeCompare(b)&&(c=a)}),c},j=function(a,b){var c=[],d=a.mentions;d.forEach(function(a){var b=a.uri[0];void 0!==a.uri[1]&&console.log("unparsed mention here");var d=parseInt(a["char"][0]),e=parseInt(a["char"][1]),f=i(this.sources,b);f&&c.push({charStart:d,charEnd:e,text:f.text})}.bind(this));var e="";return c.forEach(function(a){var b=a.text.substring(a.charStart-30,a.charStart),c=a.text.substring(a.charStart,a.charEnd),d=a.text.substring(a.charEnd,a.charEnd+30);e+=b+c+d+"\n"}),e}.bind(this);h.subscribe("filterThis",function(a,b){var c=b.chart,e=b.filters;d.events.trigger(function(){c.filter(e),c.redrawGroup()})}),this.initializeChart=function(){var a=d.subwayChart("#"+b[0].children[0].attributes.id.value),f=e.buildDimension(function(a){var b=c.time.format("%Y%m%d").parse(a.time);return[b,g.determineUniqueActors(a)]}),h=f.group().reduce(function(a,b){return a.count=a.count+1,b.labels.forEach(function(b){a.labels[b]=(a.labels[b]||0)+a.count}),b.mentions.forEach(function(b){a.mentions.push(b)}),a},function(a,b){return a.count=a.count-1,b.labels.forEach(function(b){a.labels[b]=(a.labels[b]||0)-a.count}),b.mentions.forEach(function(b){a.mentions.pop(b)}),a},function(){return{count:0,labels:{},mentions:[]}}),i=[];h.all().map(function(a){a.key[1].forEach(function(a){i.indexOf(a)<0&&i.push(a)})}),a.width(parseInt(b[0].getClientRects()[1].width,10)).height(400).margins({top:10,right:0,bottom:20,left:150}).dimension(f).group(h).filterHandler(g.customDefaultFilterHandler.bind(a)).transitionDuration(1500).x(c.time.scale()).elasticX(!0).xAxisPadding(100).keyAccessor(function(a){return a.key[0]}).y(c.scale.ordinal().domain(function(){return i}())).valueAccessor(function(a){return a.key[1]}).r(c.scale.linear()).elasticRadius(!0).radiusValueAccessor(function(a){return a.value.count>0?a.key[1].length:0}).minRadius(5).maxBubbleRelativeSize(.015).renderLabel(!0).minRadiusWithLabel(0).label(function(a){var b,c=-1,d=Object.keys(a.value.labels);return d.forEach(function(d){a.value.labels[d]>c&&(b=d,c=a.value.labels[d])}),b.toString()}).renderTitle(!0).title(function(a){var b=a.key[1],c="";b.forEach(function(a){c+=a+"\n"});var d="",e=Object.keys(a.value.labels);e.forEach(function(a){d+=a+"\n"});var f="\n---Actors-------\n"+c+"\n---Labels-------\n"+d+"\n---Mentions-----\n"+j(a.value,this.sources);return f}.bind(this)),d.override(a,"xAxisMin",function(){var b=c.min(a.data(),function(b){return a.radiusValueAccessor()(b)>0?a.keyAccessor()(b):void 0});return d.utils.subtract(b,a.xAxisPadding())}),d.override(a,"xAxisMax",function(){var b=c.max(a.data(),function(b){return a.radiusValueAccessor()(b)>0?a.keyAccessor()(b):void 0});return d.utils.add(b,a.xAxisPadding())}),d.override(a,"_prepareYAxis",function(a){this.__prepareYAxis(a),this.y().rangeBands([this.yAxisHeight(),0],0,1)}),d.override(a,"fadeDeselectedArea",function(){a.hasFilter()?a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(b){a.isSelectedNode(b)?a.highlightSelected(this):a.fadeDeselected(this)}):a.selectAll("g."+a.BUBBLE_NODE_CLASS).each(function(){a.resetHighlight(this)})}),d.override(a,"onClick",function(){}),a.render()},h.subscribe("crossfilter ready",function(){this.sources=e.getData().timeline.sources,this.initializeChart()}.bind(this))}a.$inject=["$scope","$element","d3","dc","NdxService","colorbrewer","HelperFunctions","Messagebus"],angular.module("uncertApp.subwaychart").controller("SubwayChartController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/subwaychart/subwayChart.directive.html",controller:"SubwayChartController",controllerAs:"swcCtrl"}}angular.module("uncertApp.subwaychart").directive("subwayChartDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g=function(a){a.selectAll("g.row").each(function(){b.select(this).append("path").data(b.select(this).data()).attr("class","symbol").attr("opacity","1").attr("fill",a.getColor).attr("transform",function(){return"translate("+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/4+","+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/4+")"}).attr("d",function(a){var c=b.svg.symbol();return c.size(b.select(this.parentNode).select("rect")[0][0].getAttribute("height")),c.type(e.symbolScale(a.key)),c()}.bind(this)),b.select(this).select("rect").attr("transform",function(){return"translate("+b.select(this.parentNode).select("rect")[0][0].getAttribute("height")/2+",0)"})})};this.initializeChart=function(){function f(a){return{all:function(){return a.all().filter(function(a){var b=parseInt(a.key.split(":")[0]);return b>1})},top:function(b){return a.top(1/0).filter(function(a){var b=parseInt(a.key.split(":")[0]);return b>1}).slice(0,b)}}}var h=c.rowChart("#"+a[0].children[0].attributes.id.value),i=d.buildDimension(function(a){return a.group}),j=i.group(),k=f(j);h.margins({top:20,right:0,bottom:20,left:0}).width(parseInt(a[0].getClientRects()[1].width,10)).height(400).gap(2).keyAccessor(function(a){return a.key}).colors(b.scale.category20c()).colorAccessor(function(a){var b=a.key.split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c}).dimension(i).group(k).filterHandler(e.customDefaultFilterHandler.bind(h)).ordering(function(a){var b=a.key.split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c}).x(b.scale.linear()).elasticX(!0).xAxis().tickValues([]),h.on("renderlet",g),e.setGroupColors(h.colors()),h.render()},f.subscribe("crossfilter ready",function(){this.initializeChart()}.bind(this))}a.$inject=["$element","d3","dc","NdxService","HelperFunctions","Messagebus"],angular.module("uncertApp.grouprowchart").controller("GroupRowChartController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/grouprowchart/groupRowChart.directive.html",controller:"GroupRowChartController",controllerAs:"grcCtrl"}}angular.module("uncertApp.grouprowchart").directive("groupRowChartDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){this.initializeChart=function(){function g(a){return{all:function(){return a.all().filter(function(a){var b=parseInt(a.key[0].split(":")[0]);return b>1})},top:function(b){return a.top(1/0).filter(function(a){var b=parseInt(a.key[0].split(":")[0]);return b>1}).slice(0,b)}}}var h,i=c.customBubbleChart("#"+a[0].children[0].attributes.id.value),j=e.buildDimension(function(a){var c=b.time.format("%Y%m%d").parse(a.time),d=a.group;return[d,c]}),k=j.group().reduce(function(a,b){a.climax=a.climax+b.climax;var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(d){var e=c+" : "+d;a.actors[e]=(a.actors[e]||0)+b.climax})}),a.events[b.event]=(a.events[b.event]||0)+b.climax,b.labels.forEach(function(c){a.labels[c]=(a.labels[c]||0)+b.climax}),a},function(a,b){a.climax=a.climax-b.climax;var c=Object.keys(b.actors);return c.forEach(function(c){var d=b.actors[c];d.forEach(function(d){var e=c+" : "+d;a.actors[e]=(a.actors[e]||0)-b.climax})}),a.events[b.event]=(a.events[b.event]||0)-b.climax,b.labels.forEach(function(c){a.labels[c]=(a.labels[c]||0)-b.climax}),a},function(){return{climax:0,events:{},actors:{},labels:{}}}),l=g(k);i.width(parseInt(a[0].getClientRects()[1].width,10)).height(400).margins({top:10,right:0,bottom:20,left:0}).dimension(j).group(l).filterHandler(f.customDefaultFilterHandler.bind(i)).transitionDuration(1500).x(b.time.scale()).elasticX(!0).xAxisPadding(100).keyAccessor(function(a){return a.key[1]}).y(h=b.scale.ordinal().domain(function(){var a=l.all().map(function(a){return a.key[0]});return a}()).copy()).valueAccessor(function(a){return a.key[0]}).r(b.scale.linear().domain([0,b.max(i.data(),function(a){return a.value.climax})])).radiusValueAccessor(function(a){return a.value.climax}).minRadius(2).maxBubbleRelativeSize(.015).colors(d.RdYlGn[9]).colorDomain([0,b.max(i.data(),function(a){return a.value.climax})]).colorAccessor(function(a){return a.value.climax}).renderLabel(!0).minRadiusWithLabel(0).label(function(a){var b,c=-1,d=Object.keys(a.value.labels);return d.forEach(function(d){a.value.labels[d]>c&&(b=d,c=a.value.labels[d])}),b.toString()}).renderTitle(!0).title(function(a){var b=a.key[1].getDay()+"/"+a.key[1].getMonth()+"/"+a.key[1].getFullYear(),c=Object.keys(a.value.events),d="";c.forEach(function(b){d+=a.value.events[b]+" : "+b.toString()+"\n"});var e=Object.keys(a.value.actors),f="";e.forEach(function(b){f+=a.value.actors[b]+" : "+b.toString()+"\n"});var g=Object.keys(a.value.labels),h="";g.forEach(function(b){h+=a.value.labels[b]+" : "+b.toString()+"\n"});var i="\n-----Labels-----\n"+h+"\n-----Actors-----\n"+f+"\n-----Time-------\n"+b+"\n-----Group------\n"+a.key[0];return i}),c.override(i,"xAxisMin",function(){var a=b.min(i.data(),function(a){return i.radiusValueAccessor()(a)>0?i.keyAccessor()(a):void 0});return c.utils.subtract(a,i.xAxisPadding())}),c.override(i,"xAxisMax",function(){var a=b.max(i.data(),function(a){return i.radiusValueAccessor()(a)>0?i.keyAccessor()(a):void 0});return c.utils.add(a,i.xAxisPadding())}),c.override(i,"_prepareYAxis",function(a){this.__prepareYAxis(a),this.y().rangeBands([this.yAxisHeight(),0],0,1)}),i.render()},g.subscribe("crossfilter ready",function(){this.initializeChart()}.bind(this))}a.$inject=["$element","d3","dc","colorbrewer","NdxService","HelperFunctions","Messagebus"],angular.module("uncertApp.lanechart").controller("LaneChartController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/lanechart/laneChart.directive.html",controller:"LaneChartController",controllerAs:"lcCtrl"}}angular.module("uncertApp.lanechart").directive("laneChartDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f){this.initializeChart=function(){var g=c.customSeriesChart("#"+a[0].children[0].attributes.id.value),h=d.buildDimension(function(a){var c=a.group,d=b.time.format("%Y%m%d").parse(a.time),e=a.climax;return[c,d,e]}),i=h.group().reduceSum(function(a){return+a.climax}),j=function(a){var b=c.scatterPlot(a).symbol(function(a){return e.symbolScale(a.key[0])}).symbolSize(6).highlightedSize(10).colors(e.getGroupColors()).colorAccessor(function(a){var b=a.key[0].split(":"),c=-(1e4*parseInt(b[0])+10*b[1].charCodeAt(2)+b[1].charCodeAt(3));return c});return b};g.width(parseInt(a[0].getClientRects()[1].width,10)).height(200).margins({top:10,right:10,bottom:20,left:20}).brushOn(!0).clipPadding(10).dimension(h).group(i).shareColors(!1).chart(j).seriesAccessor(function(a){return a.key[0]}).x(b.time.scale()).elasticX(!0).keyAccessor(function(a){return a.key[1]}).yAxisLabel("climax score sum").y(b.scale.linear()).elasticY(!0).renderHorizontalGridLines(!0).valueAccessor(function(a){return a.value}).filterHandler(function(a,b){return f.publish("newFilterEvent",[this,b,a]),a.filterFunction(function(a){var c=!0;return b.forEach(function(b){c===!0&&(a[1]<Math.min(b[0][0],b[1][0])||a[1]>Math.max(b[0][0],b[1][0])||a[2]<Math.min(b[0][1],b[1][1])||a[2]>Math.max(b[0][1],b[1][1]))&&(c=!1)}),c}),b}.bind(g)),g.render()},f.subscribe("crossfilter ready",function(){this.initializeChart()}.bind(this))}a.$inject=["$element","d3","dc","NdxService","HelperFunctions","Messagebus"],angular.module("uncertApp.serieschart").controller("SeriesChartController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/serieschart/seriesChart.directive.html",controller:"SeriesChartController",controllerAs:"scCtrl"}}angular.module("uncertApp.serieschart").directive("seriesChartDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f){var g={},h=function(a,b){var c;return a.forEach(function(a){0===a.uri.localeCompare(b)&&(c=a)}),c},i=function(a,b){var c=[],d=a.mentions;d.forEach(function(a){var d=a.uri[0];void 0!==a.uri[1]&&console.log("unparsed mention here");var e=parseInt(a["char"][0]),f=parseInt(a["char"][1]),g=h(b,d);g&&c.push({charStart:e,charEnd:f,text:g.text})});var e="";return c.forEach(function(a){var b=a.text.substring(a.charStart-30,a.charStart),c=a.text.substring(a.charStart,a.charEnd),d=a.text.substring(a.charEnd,a.charEnd+30);e+=b+"<span class='highlighted-mention'>"+c+"</span>"+d+"</br>"}),e};this.initializeChart=function(){var e=c.dataTable("#"+a[0].children[0].attributes.id.value),f=d.buildDimension(function(a){return[a.group,a.time,a.labels]});this.ofs=0,this.pag=17,this.tableDisplay=function(){b.select("#begin").text(this.ofs),b.select("#end").text(this.ofs+this.pag-1),b.select("#last").attr("disabled",this.ofs-this.pag<0?"true":null),b.select("#next").attr("disabled",this.ofs+this.pag>=d.getSize()?"true":null),b.select("#size").text(d.getSize())},this.tableUpdate=function(){e.beginSlice(this.ofs),e.endSlice(this.ofs+this.pag),this.tableDisplay()},this.tableNext=function(){this.ofs+=this.pag,this.tableUpdate(),e.redraw()},this.tableLast=function(){this.ofs-=this.pag,this.tableUpdate(),e.redraw()},e.dimension(f).group(function(){return""}).size(1/0).sortBy(function(a){return a.time}).order(b.ascending).columns([{label:"GroupName",format:function(a){return a.groupName}},{label:"Time",format:function(a){var c=b.time.format("%Y%m%d").parse(a.time);return c.getDay()+"/"+c.getMonth()+"/"+c.getFullYear()}},{label:"Climax Score",format:function(a){return a.climax}},{label:"Mentions",format:function(a){return i(a,g)}},{label:"Labels",format:function(a){var b="";return a.labels.forEach(function(a){b+=a+"</br>"}),b}}]),this.tableUpdate(),e.render()},f.subscribe("crossfilter ready",function(){g=d.getData().timeline.sources,this.initializeChart()}.bind(this))}a.$inject=["$element","d3","dc","NdxService","HelperFunctions","Messagebus"],angular.module("uncertApp.datatable").controller("DataTableController",a)}(),function(){"use strict";function a(){return{restrict:"E",templateUrl:"scripts/datatable/dataTable.directive.html",controller:"DataTableController",controllerAs:"dtCtrl"}}angular.module("uncertApp.datatable").directive("datatableDirective",a)}(),function(){"use strict";function a(a,b,c,d,e,f,g){var h=this;this.data={};var i=b.defer();this.ready=i.promise,this.load=function(){var b=e.DATA_JSON_URL.split(":")[0];if("file"===b){var c=e.DATA_JSON_URL.split(":")[1];d.json(c,function(a,b){return a?console.warn(a):(h.data=b,i.resolve(h.data),void f.publish("data loaded",this.getData))}.bind(this))}else"http"===b||"https"===b?h.data=a.get(e.DATA_JSON_URL).success(this.onLoad).error(this.onLoadFailure):console.log("Unknown data type.")}.bind(this),this.urlload=function(b){a.get(b.targetScope.fc.query).success(this.onUrlLoad).error(this.onLoadFailure)}.bind(this),this.onUrlLoad=function(a){h.data=a,g.success("New data loaded!"),f.publish("data loaded",this.getData)}.bind(this),this.onLoad=function(a){h.data=a,i.resolve(a),f.publish("data loaded",this.getData)}.bind(this),this.onLoadFailure=function(){c.log("Failed to load data!!"),g.error("Failed to load data!!"),i.reject.apply(this,arguments)},this.getData=function(){return this.data}.bind(this),f.subscribe("data request",this.urlload)}a.$inject=["$http","$q","$log","d3","uncertConf","Messagebus","toastr"],angular.module("uncertApp.core").service("DataService",a)}(),angular.module("uncertApp.templates").run(["$templateCache",function(a){"use strict";a.put("scripts/allactorchart/allActorChart.directive.html",'<div id="rowchart_allActors"></div>\n'),a.put("scripts/authentication/authentication.directive.html",'<div ng-show="error" class="alert alert-danger">{{error}}</div>\n<div ng-show="!authentication.loggedIn">\n  <form name="form" ng-submit="authentication.login()" role="form">\n      <div class="form-group">\n          <label for="username">Username</label>\n          <i class="fa fa-key"></i>\n          <input type="text" name="username" id="username" class="form-control" ng-model="username" required />\n          <span ng-show="form.username.$dirty && form.username.$error.required" class="help-block">Username is required</span>\n      </div>\n      <div class="form-group">\n          <label for="password">Password</label>\n          <i class="fa fa-lock"></i>\n          <input type="password" name="password" id="password" class="form-control" ng-model="password" required />\n          <span ng-show="form.password.$dirty && form.password.$error.required" class="help-block">Password is required</span>\n      </div>\n      <div class="form-actions">\n          <button type="submit" ng-disabled="form.$invalid || dataLoading" class="btn btn-danger">Login</button>\n          <img ng-if="dataLoading" src="data:image/gif;base64,R0lGODlhEAAQAPIAAP///wAAAMLCwkJCQgAAAGJiYoKCgpKSkiH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAADMwi63P4wyklrE2MIOggZnAdOmGYJRbExwroUmcG2LmDEwnHQLVsYOd2mBzkYDAdKa+dIAAAh+QQJCgAAACwAAAAAEAAQAAADNAi63P5OjCEgG4QMu7DmikRxQlFUYDEZIGBMRVsaqHwctXXf7WEYB4Ag1xjihkMZsiUkKhIAIfkECQoAAAAsAAAAABAAEAAAAzYIujIjK8pByJDMlFYvBoVjHA70GU7xSUJhmKtwHPAKzLO9HMaoKwJZ7Rf8AYPDDzKpZBqfvwQAIfkECQoAAAAsAAAAABAAEAAAAzMIumIlK8oyhpHsnFZfhYumCYUhDAQxRIdhHBGqRoKw0R8DYlJd8z0fMDgsGo/IpHI5TAAAIfkECQoAAAAsAAAAABAAEAAAAzIIunInK0rnZBTwGPNMgQwmdsNgXGJUlIWEuR5oWUIpz8pAEAMe6TwfwyYsGo/IpFKSAAAh+QQJCgAAACwAAAAAEAAQAAADMwi6IMKQORfjdOe82p4wGccc4CEuQradylesojEMBgsUc2G7sDX3lQGBMLAJibufbSlKAAAh+QQJCgAAACwAAAAAEAAQAAADMgi63P7wCRHZnFVdmgHu2nFwlWCI3WGc3TSWhUFGxTAUkGCbtgENBMJAEJsxgMLWzpEAACH5BAkKAAAALAAAAAAQABAAAAMyCLrc/jDKSatlQtScKdceCAjDII7HcQ4EMTCpyrCuUBjCYRgHVtqlAiB1YhiCnlsRkAAAOwAAAAAAAAAAAA=="/>\n      </div>\n  </form>\n<div>\n'),a.put("scripts/breadcrumbs/breadcrumbs.directive.html",'<div class="breadcrumb_class">\n  <span>Filters applied (click to remove): </span>\n  <span ng-repeat="element in bc.filters"> &gt;\n    <span ng-click="bc.click(element)"><a>{{element.filter}}</a></span>\n  </span>\n  <span class="breadcrumb_empty" ng-if="bc.filters.length == 0">No Filters</span>\n</div>\n'),a.put("scripts/datatable/dataTable.directive.html",'<table id="data-table" class="table table-hover dc-data-table dc-chart"></table>\n<div id="paging">\n  Showing <span id="begin"></span>-<span id="end"></span> of <span id="size"></span>.\n  <input id="last" type="Button" value="Last" ng-click="punchcardcontroller.tableLast()" />\n  <input id="next" type="button" value="Next" ng-click="punchcardcontroller.tableNext()"/>\n</div>\n'),a.put("scripts/fileloading/fileLoading.directive.html",'<div class="form-group clickable">\n    <div class="input-group">\n        <input type="url" class="form-control" placeholder="Datafile location..." ng-model="fc.query" ng-keypress="fc.onQueryKeyPress($event)">\n        <span class="input-group-btn">\n          <button class="btn btn-default" type="button" ng-click="fc.clear()" title="Clear"><span class="glyphicon glyphicon-remove" aria-hidden="true"></span></button>\n          <button class="btn btn-default" type="button" ng-click="fc.search()" title="Search"><span class="glyphicon glyphicon-search" aria-hidden="true"></span></button>\n        </span>\n    </div>\n</div>\n'),a.put("scripts/grouprowchart/groupRowChart.directive.html",'<div id="rowchart_groups"></div>\n'),a.put("scripts/lanechart/laneChart.directive.html",'<div id="laneChart"></div>\n'),a.put("scripts/rdf/rdf.directive.html",'<div class="container-fluid">\n  <div class="row">\n    <div class="col-md-12">\n      <div>\n        <h1>Triples found in trig file</h1>\n        <ul>\n          <li ng-repeat="triple in rdfcontroller.triples">\n            Subject: <a href="{{ triple.subject }}">{{triple.subject}}</a>,\n            Predicate: <a href="{{ triple.predicate }}">{{triple.predicate}}</a>,\n            Object: <a href="{{ triple.object }}">{{triple.object}}</a>\n          </li>\n        </ul>\n        {{ rdfcontroller.triples.length }} triples found\n      </div>\n    </div>\n  </div>\n</div>\n'),a.put("scripts/serieschart/seriesChart.directive.html",'<div id="timeline"></div>\n'),a.put("scripts/sparql/sparql.directive.html",'<div id="queryResult">\n  {{sparqlcontroller.resultText}}\n</span>\n'),a.put("scripts/subwaychart/subwayChart.directive.html",'<div id="subwayChart"></div>\n')}]);